# ESP32-S3 å®æ—¶è¯­éŸ³åŠ©æ‰‹ï¼ˆåŸºäºç«å±±å¼•æ“ç«¯åˆ°ç«¯çš„è¯­éŸ³å¤§æ¨¡å‹ï¼‰

ä¸€ä¸ªå®Œæ•´çš„ESP32-S3å®æ—¶è¯­éŸ³å¯¹è¯ç³»ç»Ÿï¼Œé€šè¿‡ç«å±±å¼•æ“çš„è¯­éŸ³æŠ€æœ¯å®ç°æ™ºèƒ½è¯­éŸ³äº¤äº’ã€‚

## ğŸŒŸ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å°†å¸¦ä½ ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ESP32-S3å®æ—¶è¯­éŸ³å¯¹è¯ç³»ç»Ÿã€‚åˆ©ç”¨ç«å±±å¼•æ“çš„è¯­éŸ³æŠ€æœ¯ï¼Œé…åˆPythonä¸­è½¬æœåŠ¡å™¨ï¼Œè®©ESP32-S3å¼€å‘æ¿ä¹Ÿèƒ½å®ç°æµç•…ã€æ™ºèƒ½çš„è¯­éŸ³äº¤äº’ã€‚

### ä¸»è¦åŠŸèƒ½
- **å®æ—¶è¯­éŸ³è¯†åˆ«ï¼ˆASRï¼‰**ï¼šå°†ç”¨æˆ·çš„è¯­éŸ³æµå®æ—¶è½¬æ¢ä¸ºæ–‡å­—
- **æ™ºèƒ½å¯¹è¯**ï¼šå¯¹è¯†åˆ«å‡ºçš„æ–‡å­—è¿›è¡Œç†è§£ï¼Œå¹¶ç”Ÿæˆå›å¤æ–‡æœ¬
- **å®æ—¶è¯­éŸ³åˆæˆï¼ˆTTSï¼‰**ï¼šå°†å›å¤æ–‡æœ¬å®æ—¶åˆæˆä¸ºè¯­éŸ³æµ
- **æ–‡æœ¬æ˜¾ç¤º**ï¼šå°†è¯­éŸ³è¯†åˆ«çš„æ–‡æœ¬å’Œå¤§æ¨¡å‹å›å¤çš„æ–‡æœ¬é€šè¿‡ssd1306æ˜¾ç¤º
- **å®Œæ•´äº¤äº’é—­ç¯**ï¼šå½•éŸ³ -> è¯†åˆ« -> å¯¹è¯ -> åˆæˆ -> æ’­æ”¾

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ESP32-S3å®¢æˆ·ç«¯ (MicroPython)
- é€šè¿‡I2Séº¦å…‹é£å®æ—¶é‡‡é›†éŸ³é¢‘æ•°æ®
- é€šè¿‡WebSocketå°†éŸ³é¢‘æ•°æ®æµå¼ä¼ è¾“åˆ°ä¸­è½¬æœåŠ¡å™¨
- æ¥æ”¶ä¸­è½¬æœåŠ¡å™¨ä¸‹å‘çš„éŸ³é¢‘æµï¼Œå¹¶é€šè¿‡I2SåŠŸæ”¾æ’­æ”¾

### Pythonä¸­è½¬æœåŠ¡å™¨
- æ¥æ”¶ESP32-S3çš„WebSocketè¿æ¥
- ä¸ç«å±±å¼•æ“çš„WebSocketæœåŠ¡å»ºç«‹è¿æ¥å¹¶å¤„ç†è®¤è¯é€»è¾‘
- åœ¨ä¸¤æ¡WebSocketè¿æ¥ä¹‹é—´é«˜æ•ˆã€ä½å»¶è¿Ÿåœ°åŒå‘è½¬å‘éŸ³é¢‘æ•°æ®æµ

### ç«å±±å¼•æ“ (æä¾›PaaSèƒ½åŠ›)
- å®æ—¶è¯­éŸ³è¯†åˆ«æœåŠ¡
- å¯¹è¯ç³»ç»Ÿ
- å®æ—¶è¯­éŸ³åˆæˆæœåŠ¡

## ğŸ“‹ ç¡¬ä»¶å‡†å¤‡

### å¿…éœ€ç¡¬ä»¶
- **ä¸»æ§**: ESP32-S3å¼€å‘æ¿ï¼ˆæ¨èï¼Œæ€§èƒ½æ›´ä¼˜ï¼‰
- **éŸ³é¢‘è¾“å…¥**: I2Séº¦å…‹é£æ¨¡å—ï¼ˆæ¨èINMP441ï¼Œä¿¡å™ªæ¯”é«˜ï¼‰
- **éŸ³é¢‘è¾“å‡º**: I2SåŠŸæ”¾æ¨¡å—å’Œæ‰¬å£°å™¨ï¼ˆæ¨èMAX98357Aæ¨¡å—ï¼‰
- **æ–‡æœ¬æ˜¾ç¤º**: I2Cæ˜¾ç¤ºæ¨¡å—(ssd1306æ˜¾ç¤ºå™¨)
- **è¿æ¥çº¿**: æœé‚¦çº¿è‹¥å¹²

### æ¥çº¿å‚è€ƒ
| æ¨¡å—åç§° | å¼•è„š | è¿æ¥è‡³ESP32-S3 |
|---------|------|---------------|
| INMP441 (éº¦å…‹é£) | SCK | GPIO5 |
| | WS | GPIO6 |
| | SD | GPIO7 |
| MAX98357A (åŠŸæ”¾) | BCLK | GPIO12 |
| | LRC | GPIO11 |
| | DIN | GPIO13 |
| ssd1306 (æ˜¾ç¤º) | SCL | GPIO1 |
| | SDA | GPIO2 |
| é€šç”¨å¼•è„š | VDD/VIN | 3.3V |
| | GND | GND |

> **æ³¨æ„**: ä»¥ä¸Šä¸ºé»˜è®¤å¼•è„šé…ç½®ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µåœ¨ä»£ç ä¸­ä¿®æ”¹ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å·¥ä½œ
1. **è½¯ä»¶ç¯å¢ƒ**
   - Python 3.7æˆ–æ›´é«˜ç‰ˆæœ¬
   - MicroPython IDEï¼ˆæ¨èThonnyï¼‰
   - Git

2. **äº‘æœåŠ¡è´¦å·**
   - è®¿é—®[ç«å±±å¼•æ“å®˜ç½‘](https://www.volcengine.com/)æ³¨å†Œè´¦å·
   - å¼€é€šç›¸å…³æœåŠ¡å¹¶è·å–`App-ID`å’Œ`Access-Key`

### ç¬¬äºŒæ­¥ï¼šæœåŠ¡å™¨ç«¯éƒ¨ç½²
```bash
# 1. å…‹éš†é¡¹ç›®ä»£ç 
git clone https://github.com/zhou19830318/S2S_doubao_esp32s3_Agent.git
cd S2S_doubao_esp32s3_Agent

# 2. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python -m venv venv
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install -r Agent_Server/requirements.txt

# 4. é…ç½®å¯†é’¥
# æ‰“å¼€ Agent_Server/config.py æ–‡ä»¶
# ä¿®æ”¹ ws_connect_config ä¸­çš„ App-ID å’Œ Access-Key

# 5. æµ‹è¯•APIè¿æ¥
python Agent_Server/local_agent_test.py

# 6. å¯åŠ¨æœåŠ¡å™¨
python Agent_Server/esp32_server.py
```

### ç¬¬ä¸‰æ­¥ï¼šå®¢æˆ·ç«¯éƒ¨ç½²
1. **åˆ·å…¥MicroPythonå›ºä»¶**
   - ä»[MicroPythonå®˜ç½‘](https://micropython.org/download/ESP32_GENERIC_S3/)ä¸‹è½½å›ºä»¶
   - ä½¿ç”¨esptool.pyåˆ·å…¥ESP32-S3

2. **é…ç½®å®¢æˆ·ç«¯**
   - ä½¿ç”¨Thonny IDEè¿æ¥ESP32-S3
   - ä¸Šä¼ `esp32_client.py`åˆ°ESP32-S3
   - ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š
     ```python
     # ä¿®æ”¹I2Så¼•è„šé…ç½®
     self.I2S_SCK_I, self.I2S_WS_I, self.I2S_SD_I = Pin(5), Pin(6), Pin(7)
     self.I2S_SCK_O, self.I2S_WS_O, self.I2S_SD_O = Pin(12), Pin(11), Pin(13)
     
     # ä¿®æ”¹Wi-Fiä¿¡æ¯
     self.WIFI_SSID, self.WIFI_PASSWORD = "ä½ çš„WiFiåç§°", "ä½ çš„WiFiå¯†ç "
     
     # ä¿®æ”¹æœåŠ¡å™¨IPåœ°å€
     self.SERVER_URL = "ws://192.168.1.6:8765"  # æ›¿æ¢ä¸ºç”µè„‘çš„å±€åŸŸç½‘IP
     
     ```

3. **è¿è¡Œå®¢æˆ·ç«¯**
   - åœ¨Thonnyä¸­æŒ‰F5è¿è¡Œä»£ç 
   - è§‚å¯ŸREPLè¾“å‡ºï¼Œç¡®è®¤è¿æ¥æˆåŠŸ

## ğŸ”§ è”è°ƒä¸éªŒè¯

æˆåŠŸéƒ¨ç½²åï¼š
1. **ESP32-S3ç«¯**æ˜¾ç¤ºï¼š
   ```
   MPY: soft reboot
   WiFi Connected: 192.168.1.8
   I2S HW Buffer: 64KB
    
   [System] Free memory: 140.0 KB
   [WS] Connecting to ws://192.168.1.6:8765...
   [WS] Opening connection to 192.168.1.6:8765...
   [WS] Waiting for handshake response...
   [WS] Handshake successful.
   [System] Connected to server.
   [Record] Task started.
   [Recv] Task started.
   [Play] Task started.
   [Record] Sent 10 KB
   [Record] Sent 20 KB
   [Record] Sent 30 KB
   [Record] Sent 40 KB
   ...
   ```

2. **æœåŠ¡å™¨ç«¯**æ˜¾ç¤ºï¼š
   ```
   [Server] New connection: ...
   ```

3. **æµ‹è¯•**ï¼š
   - å¯¹ç€éº¦å…‹é£è¯´"ä½ å¥½ï¼Œè±†åŒ…"å±å¹•æ˜¾ç¤ºï¼Œ"U:ä½ å¥½ï¼Œè±†åŒ…"
   - æœåŠ¡å™¨ç«¯å¼€å§‹æ‰“å°äº‘ç«¯ä¼šè¯æ—¥å¿—
   - ESP32-S3æ‰¬å£°å™¨æ’­æ”¾è±†åŒ…çš„å›å¤ï¼Œå±å¹•æ˜¾ç¤º"A:è±†åŒ…çš„å›å¤..."

## â“ å¸¸è§é—®é¢˜

### 1. ESP32-S3æ— æ³•è¿æ¥Wi-Fi
- âœ… æ£€æŸ¥`WIFI_SSID`å’Œ`WIFI_PASSWORD`æ˜¯å¦æ­£ç¡®
- âœ… ç¡®ä¿ä½¿ç”¨2.4GHz Wi-Fiï¼ˆESP32-S3å¯¹5GHzæ”¯æŒä¸ä½³ï¼‰

### 2. æ— æ³•è¿æ¥æœåŠ¡å™¨
- âœ… ç¡®è®¤`SERVER_URL`ä¸­çš„IPåœ°å€æ˜¯æœåŠ¡å™¨ç”µè„‘çš„å½“å‰å±€åŸŸç½‘IP
- âœ… ç¡®ä¿ESP32-S3å’Œç”µè„‘åœ¨åŒä¸€Wi-Fiç½‘ç»œä¸‹
- âœ… æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œå…è®¸8765ç«¯å£è®¿é—®

### 3. æ²¡æœ‰å£°éŸ³æˆ–å£°éŸ³å¼‚å¸¸
- âœ… æ£€æŸ¥I2Så¼•è„šæ¥çº¿æ˜¯å¦ä¸ä»£ç å®šä¹‰ä¸€è‡´
- âœ… ç¡®è®¤éº¦å…‹é£å’ŒåŠŸæ”¾æ¨¡å—çš„VDDå’ŒGNDè¿æ¥æ­£ç¡®
- âœ… è°ƒè¯•`record_task`ï¼Œç¡®è®¤èƒ½è¯»åˆ°éŸ³é¢‘æ•°æ®

## ğŸ“ é¡¹ç›®ç»“æ„
```
S2S_doubao_esp32s3_Agent/
â”œâ”€â”€ Agent_Server/
â”‚   â”œâ”€â”€ config.py          # æœåŠ¡å™¨é…ç½®ï¼ˆå¯†é’¥ç­‰ï¼‰
â”‚   â”œâ”€â”€ esp32_server.py    # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”‚   â”œâ”€â”€ local_agent_test.py # APIæµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ requirements.txt    # Pythonä¾èµ–
â”œâ”€â”€ esp32_client.py        # ESP32å®¢æˆ·ç«¯ä¸»æ–‡ä»¶
â”œâ”€â”€ ssd1306.py             # ssd1306å±å¹•é©±åŠ¨
â”œâ”€â”€ ufont.py               # æ–‡å­—æ˜¾ç¤ºå¤„ç†ä»£ç 
â”œâ”€â”€ easydisplay.py         # å±å¹•æ˜¾ç¤ºå°è£…å‡½æ•°
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ¯ æ‰©å±•åŠŸèƒ½

åŸºäºæ­¤é¡¹ç›®ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢ï¼š
- **è‡ªå®šä¹‰å”¤é†’è¯**ï¼šé›†æˆè½»é‡çº§æœ¬åœ°å”¤é†’è¯å¼•æ“
- **æ™ºèƒ½å®¶å±…æ§åˆ¶**ï¼šé€šè¿‡è¯­éŸ³æ§åˆ¶ç¯å…‰ã€å¼€å…³ç­‰è®¾å¤‡
- **æœºå™¨äººäº¤äº’**ï¼šä½œä¸ºæœºå™¨äººçš„è¯­éŸ³äº¤äº’ä¸­æ¢
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ‰©å±•æ”¯æŒæ›´å¤šè¯­è¨€çš„è¯†åˆ«å’Œåˆæˆ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªMITè®¸å¯è¯ã€‚è¯¦è§LICENSEæ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›æœ¬é¡¹ç›®ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [ç«å±±å¼•æ“å®˜ç½‘](https://www.volcengine.com/)
- [MicroPythonå®˜ç½‘](https://micropython.org/)
- [Thonny IDE](https://thonny.org/)
- [ESP32å®˜æ–¹æ–‡æ¡£](https://docs.espressif.com/)
- [CSDNæ•™ç¨‹æ–‡æ¡£](https://blog.csdn.net/acldy833/article/details/156279168?sharetype=blogdetail&shareId=156279168&sharerefer=APP&sharesource=acldy833&sharefrom=link)
